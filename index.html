<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="看清现实，心怀梦想，幽默面对。">
<meta property="og:type" content="website">
<meta property="og:title" content="jasonli822的博客">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="jasonli822的博客">
<meta property="og:description" content="看清现实，心怀梦想，幽默面对。">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="jasonli822的博客">
<meta name="twitter:description" content="看清现实，心怀梦想，幽默面对。">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>jasonli822的博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">jasonli822的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Java、Android Notes</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            公益404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/27/spring-cloud-microservice-example/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason Li">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/assets/totoro.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jasonli822的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/27/spring-cloud-microservice-example/" itemprop="url">SpringCloud微服务示例</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-27T15:07:00+08:00">
                2018-04-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring-Cloud/" itemprop="url" rel="index">
                    <span itemprop="name">Spring Cloud</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本指南将帮助您学习微服务和微服务架构的基础知识。 我们也将开始着眼于使用Spring Cloud的微服务的基本实现。</p>
<blockquote>
<p>我们将创建一些服务，并使用Eureka实现服务治理和Ribbon来实现客户端负载均衡。</p>
</blockquote>
<p>在本系列文章中，我们将创建两个微服务：</p>
<ul>
<li>Forex Service（外汇服务） - 简称为FS</li>
<li>Currency Conversion Service（货币转换服务） - 简称为CCS</li>
</ul>
<h2 id="外汇服务-Forex-Service"><a href="#外汇服务-Forex-Service" class="headerlink" title="外汇服务 Forex Service"></a>外汇服务 Forex Service</h2><p>外汇服务(Forex Service)是服务提供商。它提供各种货币的货币兑换值。我们假设它与外汇交易所通信并提供货币之间当前转换价值。</p>
<p>示例请求和响应如下所示：</p>
<p>GET to <a href="http://localhost:8000/currency-exchange/from/EUR/to/INR" target="_blank" rel="noopener">http://localhost:8000/currency-exchange/from/EUR/to/INR</a></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  id: 10002,</span><br><span class="line">  from: "EUR",</span><br><span class="line">  to: "INR",</span><br><span class="line">  conversionMultiple: 75,</span><br><span class="line">  port: 8000</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的请求是EUR(欧元)兑换INR(印度卢比)的货币交换值。在响应中，转换倍数为75。</p>
<h2 id="货币转换服务-Currency-Conversion-Service"><a href="#货币转换服务-Currency-Conversion-Service" class="headerlink" title="货币转换服务 Currency Conversion Service"></a>货币转换服务 Currency Conversion Service</h2><p>货币兑换服务(Currency Conversion Service 简称CCS)可以将一种货币转换为另一种货币。它使用外汇服务获取当前货币兑换值。CCS是服务消费者。</p>
<p>示例请求和响应如下所示：</p>
<p>GET to <a href="http://localhost:8100/currency-converter/from/EUR/to/INR/quantity/10000" target="_blank" rel="noopener">http://localhost:8100/currency-converter/from/EUR/to/INR/quantity/10000</a></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  id: 10002,</span><br><span class="line">  from: "EUR",</span><br><span class="line">  to: "INR",</span><br><span class="line">  conversionMultiple: 75,</span><br><span class="line">  quantity: 10000,</span><br><span class="line">  totalCalculatedAmount: 750000,</span><br><span class="line">  port: 8000</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的请求是计算10000 EUR(欧元)兑换INR(印度卢比)的货币的价值。兑换金额为750000 INR。</p>
<p>下图显示了CCS和FS之间的通信。</p>
<p><img src="/assets/blogImg/springcloud/Spring-Boot-Microservice-1-CCS-FS.png" alt="image"></p>
<h2 id="Eureka服务治理-和-Ribbon"><a href="#Eureka服务治理-和-Ribbon" class="headerlink" title="Eureka服务治理 和 Ribbon"></a>Eureka服务治理 和 Ribbon</h2><p>基于负载，我们可以有多个货币转换(CCS)服务</p>
<p><img src="/assets/blogImg/springcloud/Spring-Boot-Microservice-2-CCS.png" alt="image"></p>
<p>和多个外汇服务(FS)</p>
<p><img src="/assets/blogImg/springcloud/Spring-Boot-Microservice-3-FSInstances.png" alt="image"></p>
<p>每个服务的实例数量可能会随时间而变化（动态扩展和缩减每个服务的实例数量）。下图显示了有5个外汇服务实例的特定实例。</p>
<p><img src="/assets/blogImg/springcloud/Spring-Boot-Microservice-4-5FSInstances.png" alt="image"></p>
<p>在上述情况下需要发生的是负载应该在这5个实例之间均匀分配。</p>
<p><img src="/assets/blogImg/springcloud/Spring-Boot-Microservice-5-CCSToFS5instances.png" alt="image"></p>
<p>在本系列文章中，我们将使用Ribbon进行负载均衡，并且使用Eureka来注册所有的微服务。</p>
<p>实现服务的动态扩展和缩减有如下两个问题：</p>
<ul>
<li>货币转换服务(CCS)如何知道有多少个外汇服务(FS)处于活动状态？</li>
<li>货币转换服务(CCS)如何在多个外汇服务(FS)活动实例之间分配负载？</li>
</ul>
<p>因为我们希望这是动态的，所以我们不能在CSS中编码FS的URL。这就是我们为什么需要引入一个服务的注册和发现机制。</p>
<p>组件的所有实例(CCS和FS)都向Eureka命名服务器注册。当CSS需要调用FS时，它会向Eureka命名服务器询问活动实例。我们将使用Ribbon在FS不同实例之间进行客户端负载均衡。</p>
<p>下图显示了从CCS到FS请求时的序列图：</p>
<p><img src="/assets/blogImg/springcloud/Spring-Boot-Microservice-7-Eureka-Sequence-Diagram.png" alt="image"></p>
<p>本Demo项目包括以下内容：</p>
<ul>
<li>创建一个外汇服务(FS) - 我们将基于Spring Boot Starter Web 和 Spring Boot Started JPA 创建一个简单的rest service。我们将使用JPA并连接到H2数据库。</li>
<li>创建货币转换服务(CCS) - 我们将使用Feign创建一个简单的rest service来调用外汇服务(FS)</li>
<li>使用Ribbon实现负载均衡</li>
<li>使用Eureka实现服务注册和发现</li>
</ul>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>依次启动 Eureka 服务(spring-cloud-microservice-eureka)、两个外汇服务(springcloud-microservice-forex-servcie，端口分别是：8000,8001)以及货币转换服务：</p>
<p><img src="/assets/blogImg/springcloud/spring-cloud-microservice-example-eureka.png" alt="image"></p>
<p>从上图可以看到看到一个货币转换服务(CCS)实例和两个外汇服务(FS)微服务实例在Eureka命名服务器上注册。CCS的请求将通过Eureka由Ribbon分发给外汇服务(FS)的两个实例。</p>
<p>请求1：<br>Get to <a href="http://localhost:8100/currency-converter-feign/from/EUR/to/INR/quantity/10000" target="_blank" rel="noopener">http://localhost:8100/currency-converter-feign/from/EUR/to/INR/quantity/10000</a></p>
<p><img src="/assets/blogImg/springcloud/spring-cloud-microservice-example-request-1.png" alt="image"></p>
<p>请求2：<br>Get to <a href="http://localhost:8100/currency-converter-feign/from/EUR/to/INR/quantity/10000" target="_blank" rel="noopener">http://localhost:8100/currency-converter-feign/from/EUR/to/INR/quantity/10000</a></p>
<p><img src="/assets/blogImg/springcloud/spring-cloud-microservice-example-request-2.png" alt="image"></p>
<p>我们可以看到两个响应中的端口号是不同的。</p>
<p>代码已上传 <a href="https://github.com/jasonli822/springcloud-microservice-example" target="_blank" rel="noopener">GitHub</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/24/blockchain/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason Li">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/assets/totoro.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jasonli822的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/24/blockchain/" itemprop="url">区块链技术简介</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-24T10:11:48+08:00">
                2018-04-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="什么是区块链"><a href="#什么是区块链" class="headerlink" title="什么是区块链"></a>什么是区块链</h2><p><span style="color:red;">区块链本质上是一个去中心化的分布式账本数据库，是比特币的底层技术。</span></p>
<p>位于全球计算机节点，部分会作为区块链的“小账本”</p>
<p>所有的小账本按照一定的规则连在一起，形成区块链</p>
<p>每个账本发生的业务不同，但按照相同的规则同步合并信息，这样的体系就是区块链系统。</p>
<h2 id="区块链的优势"><a href="#区块链的优势" class="headerlink" title="区块链的优势"></a>区块链的优势</h2><p>A转钱给B -&gt; 先记在一个小账本上 -&gt; 通知所有的小账本信息更新 -&gt; 各个账本都确认信息受信 -&gt; 各个小账本信息同步 -&gt; 交易完成</p>
<h3 id="分布式去中心化"><a href="#分布式去中心化" class="headerlink" title="分布式去中心化"></a>分布式去中心化</h3><p><img src="/assets/blogImg/blockchain/Centralized-payment-methods.png" alt="image"></p>
<p><img src="/assets/blogImg/blockchain/Decentralized-payment-methods.png" alt="image"></p>
<h3 id="匿名性"><a href="#匿名性" class="headerlink" title="匿名性"></a>匿名性</h3><p><img src="/assets/blogImg/blockchain/Anonymity.png" alt="image"></p>
<h2 id="区块链难以克服的缺点"><a href="#区块链难以克服的缺点" class="headerlink" title="区块链难以克服的缺点"></a>区块链难以克服的缺点</h2><p>效率问题</p>
<p>人才成本高 - 密码学，计算数学，人工智能</p>
<h2 id="举例理解"><a href="#举例理解" class="headerlink" title="举例理解"></a>举例理解</h2><p><a href="https://mp.weixin.qq.com/s/PUWLS-J5UmYV1pUsV3ZUpA" target="_blank" rel="noopener">中本聪算啥？六百多年前区块链项目就在中国落地了！| 财链社</a> 文章对理解什么式区块链讲解的很形象，摘抄如下:</p>
<p>周末到了，张三准备约上几个好友出来打麻将，于是就打电话约了李四、王五、赵六组了个麻将局。<br>而张三想打麻将的想法就相当于创建一个区块，而他再以打电话点对点的形式通知了李四、王五、赵六这个动作就做到了<b>“去中心化”的点对点传输。</b>  </p>
<p>于是张三、李四、王五、赵六就形成了共识，坐到了一起开始打麻将。四个人会分别摸13张随机分配的麻将，通过摸一张打一张的形式来将麻将规范化的排序来和牌。<b>而这里面摸打的动作就可以理解为“挖矿”，四个人就是“矿工”，108张麻将就是哈希值。而胡牌就是碰撞出了正确的哈希值，就可以获得相应的筹码奖励，也就是所谓的比特币。</b></p>
<p>那么问题来了，为什么其他三个人都会主动给和牌的人奖励呢？那是因为这三个人都自动达成了共识，这人确实赢了，大家都记录了这笔账，想抵赖是不行的，不然以后传出去这人品不行，就没人再和他一起打麻将了，毕竟圈子很重要。</p>
<p>同时，在大家达成共识时，我们看不到任何中介或者第三方出来评判谁赢了，大家给赢得人的奖励也不需要通过第三方转交给他，都是直接点对点交易，<b>这一过程就是去中心化。</b></p>
<p>四个人（矿工）各自记录了第一局的战绩，王五大胡自摸七小对，赵六杠了张三的幺鸡，记录完成后就生成了一个完整的区块，但要记住，这才只是第一局，在整个区块链上，这才仅仅是一个节点，如果那天一共打了20盘麻将，<b>也就是20个节点（区块），20个区块连接在一起就形成了一个完整账本，这就是区块链。</b></p>
<p>因为这个账本每人都有一个，所以就是<b>分布式账本</b>，目的就是为了防止有人篡改记录，打到最后，谁输谁赢一目了然。</p>
<p>整个过程，将区块链技术体现得淋漓尽致。</p>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><p><a href="https://mp.weixin.qq.com/s/PUWLS-J5UmYV1pUsV3ZUpA" target="_blank" rel="noopener">中本聪算啥？六百多年前区块链项目就在中国落地了！| 财链社</a><br><a href="https://sale.jd.com/act/dqtmRyTIuQkFHG4.html?cu=true&amp;utm_source=segmentfault.com&amp;utm_medium=tuiguang&amp;utm_campaign=t_1000470991_&amp;utm_term=7e5d183b70ed4a98ad0721a8374ffa9f&amp;abt=3" target="_blank" rel="noopener">区块链-京东图书专题活动</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/04/23/microservices-and-springcloud-introduction/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason Li">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/assets/totoro.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jasonli822的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/23/microservices-and-springcloud-introduction/" itemprop="url">微服务与Spring Cloud简介</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-23T07:18:56+08:00">
                2018-04-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Spring-Cloud/" itemprop="url" rel="index">
                    <span itemprop="name">Spring Cloud</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="一、首先谈谈传统架构和微服务架构"><a href="#一、首先谈谈传统架构和微服务架构" class="headerlink" title="一、首先谈谈传统架构和微服务架构"></a>一、首先谈谈传统架构和微服务架构</h2><p>传统的系统架构是单一架构模式。这种架构模式就是把应用整体打包部署，具体的样式依赖本身应用采用的语言，如果采用java语言，自然你会打包成war包，部署在Tomcat或者Jetty这样的应用服务器上，如果你使用spring boot还可以打包成jar包部署。其他还有Rails和Node.js应用以目录层次的形式打包。<br><img src="/assets/blogImg/springcloud/monomer_application.png" alt="image"></p>
<p>微服务架构则是将单个的整体应用程序分割成更小的项目关联的独立的服务。一个服务通常实现一组独立的特性或功能，包含自己的业务逻辑和适配器。各个微服务之间的关联通过暴露api来实现。这些独立的微服务不需要部署在同一个虚拟机，同一个系统和同一个应用服务器中。</p>
<h2 id="二、为什么需要微服务架构？"><a href="#二、为什么需要微服务架构？" class="headerlink" title="二、为什么需要微服务架构？"></a>二、为什么需要微服务架构？</h2><p>单一架构模式在项目初期很小的时候开发方便，测试方便，部署方便，运行良好。可是当应用随着时间的推进，加入的功能越来越多，最终会变得巨大，一个项目中很有可能数百万行的代码，互相之间繁琐的jar包。</p>
<p>1、    不再适用敏捷开发，过于复杂，任何开发者都不能够完全理解，修复漏洞和实现新功能变得困难和耗时。</p>
<p>2、    规模越大，启动时间越长，自然会拖慢开发进度，一个小功能的修改部署起来变得困难，必须重新部署整个应用。</p>
<p>3、    系统的不同的模块的需要不同的特定的虚拟机环境时，由于是整体应用，那么只能折中选择。</p>
<p>4、    任意模块的漏洞或者错误都会影响这个应用，降低系统的可靠性</p>
<p>5、    还有一个如果想整体应用采用新的技术，新的框架或者语言，那是不可能的。</p>
<p>微服务一词来自Martin Fowler的Microservices一文，微服务是一种架构风格，将单体应用划分为小型的服务单元，微服务使用HTTP的API进行资源访问与操作。</p>
<p>如果采用微服务架构模式，则可以解决单一架构模式带来的系统复杂性。主要包括以下几个好处：</p>
<p>1、    由于每个服务都是独立并且微小的，由单独的团队负责，仍然可以采用敏捷开发模式，自由的选择合适的技术，甚至可以重写老服务，当然都要遵守统一的API约定。</p>
<p>2、    每一个微服务都是独立部署的，可以进行快速迭代部署，根据各自服务需求选择合适的虚拟机和使用最匹配的服务资源要求的硬件。</p>
<p>3、    整体应用程序被分解成可管理的模块和服务，单个的服务可以更快的开发、更简单的理解和维护。</p>
<p>4、    一些需要进行负载均衡的服务可以部署在多个云虚拟机上，加入NGINX这样的负载均衡器在多个实例之间分发请求，这样不需要整个应用进行负载均衡了。</p>
<p>每个后端服务暴露一套REST API，大部分服务调用其他服务提供的API。每个服务都有自己的数据库模式，而不是共享单个数据库模式。尽管这会造成某些数据的冗余，但是对于微服务架构这个独立数据库模式是必要的，确保了独立服务之间的松散耦合。</p>
<p>以上介绍的微服务架构模式表面上类似于SOA，两种架构都包含一组服务。可以认为微服务架构是不包括Web服务规范（WS-）、企业服务总线（ESB）的SOA。基于微服务的应用倾向于使用更简单轻量级的协议，比如 REST 而不是 WS-。微服务自己实现类似 ESB 的功能并且拒绝 SOA 的其他部分，比如规范模式的概念。</p>
<p>（SOA架构侧重于将每个单体应用的服务集成到企业服务总线ESB上，而微服务做得更加彻底，强调将整个模块变成服务组件，微服务对模块的划分粒度可能会更细。）</p>
<p><img src="/assets/blogImg/springcloud/SOA_Structure.png" alt="image"></p>
<p><img src="/assets/blogImg/springcloud/Microservices_Structure.png" alt="image"></p>
<h2 id="三、微服务架构的不足"><a href="#三、微服务架构的不足" class="headerlink" title="三、微服务架构的不足"></a>三、微服务架构的不足</h2><p>1、  微服务应用作为分布式系统带来了复杂性。当应用是整体应用程序时，模块之间调用都在应用之内，即使进行分布式部署，依然在应用内调用。可是微服务是多个独立的服务，当进行模块调用的时候，分布式将会麻烦。</p>
<p>2、  多个独立数据库，事务的实现更具挑战性。</p>
<p>3、  测试微服务变得复杂，当一个服务依赖另外一个服务时，测试时候需要另外一个服务的支持。</p>
<p>4、  部署基于微服务的应用也很复杂，整体应用程序部署只需要部署在一组相同的服务器上，在这些服务前面加入传统的负载均衡器即可。独立服务的不是讲变得复杂，需要更高的自动化形式。</p>
<h2 id="四、总结"><a href="#四、总结" class="headerlink" title="四、总结"></a>四、总结</h2><p>单体式的架构更适合轻量级的简单应用。如果你用它来开发复杂应用，那真的会很糟糕。微服务架构模式可以用来构建复杂应用，当然，这种架构模型也有自己的缺点和挑战。</p>
<h2 id="五、Spring-Cloud简介"><a href="#五、Spring-Cloud简介" class="headerlink" title="五、Spring Cloud简介"></a>五、Spring Cloud简介</h2><p>Spring Cloud是一个集成了众多开源的框架，利用Spring Boot的开发便利性实现了服务治理、服务注册与发现、负载均衡、数据监控，REST API发布方式等，基本囊括了分布式框架所需要的所有功能。是一套易开放、易部署、易维护的分布式开发工具包。</p>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul>
<li><a href="https://www.cnblogs.com/hongxf1990/p/6491014.html" target="_blank" rel="noopener">https://www.cnblogs.com/hongxf1990/p/6491014.html</a></li>
<li>《疯狂Spring Cloud微服务架构实战》</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/08/29/expcetion-tracking-with-sentry/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason Li">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/assets/totoro.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jasonli822的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/29/expcetion-tracking-with-sentry/" itemprop="url">利用Sentry追踪日志发现问题(expcetion-tracking-with-sentry)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-29T21:01:48+08:00">
                2017-08-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><blockquote>
<p>Open-source error tracking that helps developers monitor and fix crashes in real time. Iterate continuously. Boost efficiency. Improve user experience.</p>
</blockquote>
<p>sentry是一个现代化的错误日志记录和聚合平台。支持几乎所有主流开发语言和平台, 并提供了现代化UI, 本文简单介绍一下使用sentry平台记录后台错误日志。</p>
<h1 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h1><p>访问<a href="https://sentry.io/signup/" target="_blank" rel="noopener">https://sentry.io/signup/</a>注册一个sentry账号。</p>
<h1 id="创建Team，Project"><a href="#创建Team，Project" class="headerlink" title="创建Team，Project"></a>创建Team，Project</h1><p>用创建好的账号登录，创建Team和Project.</p>
<p><img src="/assets/blogImg/expcetion-tracking-with-sentry/project_setting.jpg" alt="image"></p>
<p>设置下语言和时区</p>
<p><img src="/assets/blogImg/expcetion-tracking-with-sentry/account_setting.jpg" alt="image"></p>
<h1 id="集成到Spring-Boot项目"><a href="#集成到Spring-Boot项目" class="headerlink" title="集成到Spring Boot项目"></a>集成到Spring Boot项目</h1><p>参考<a href="https://github.com/pwielgolaski/sentry" target="_blank" rel="noopener">https://github.com/pwielgolaski/sentry</a></p>
<p>1). pom.xml<br>增加raven-logback依赖<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.kencochrane.raven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>raven-logback<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>2). logback.xml<br>增加sentry配置<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">resource</span>=<span class="string">"org/springframework/boot/logging/logback/defaults.xml"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"LOG_FILE"</span> <span class="attr">value</span>=<span class="string">"$&#123;LOG_FILE:-$&#123;LOG_PATH:-$&#123;LOG_TEMP:-$&#123;java.io.tmpdir:-/tmp&#125;&#125;/&#125;spring.log&#125;"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">resource</span>=<span class="string">"org/springframework/boot/logging/logback/console-appender.xml"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">"SENTRY"</span> <span class="attr">class</span>=<span class="string">"net.kencochrane.raven.logback.SentryAppender"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dsn</span>&gt;</span>YOUR_URL_PROVIDED_BY_SENTRY<span class="tag">&lt;/<span class="name">dsn</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">"ch.qos.logback.classic.filter.ThresholdFilter"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>WARN<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">"INFO"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"CONSOLE"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"SENTRY"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>dsn这里配置项目的dsn地址，如下图所示：</p>
<p><img src="/assets/blogImg/expcetion-tracking-with-sentry/dsn.jpg" alt="image"></p>
<p>3). 测试类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SentryApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> Logger logger = LoggerFactory.getLogger(SentryApplication.class);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(SentryApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(method = RequestMethod.GET)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">generateErrors</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        logException(<span class="keyword">new</span> NullPointerException(<span class="string">"NPE"</span>));</span><br><span class="line">        logException(<span class="keyword">new</span> IllegalArgumentException(<span class="string">"Illegal"</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Exceptions generated"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">logException</span><span class="params">(Exception ex)</span> </span>&#123;</span><br><span class="line">        logger.error(<span class="string">"Logger message for "</span> + ex.getClass().getSimpleName(), ex);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行测试类，可以看到日志已经记录到sentry上去了。</p>
<p><img src="/assets/blogImg/expcetion-tracking-with-sentry/Unresolved_Issues.jpg" alt="image"></p>
<p>点击问题可以查看问题详细：</p>
<p><img src="/assets/blogImg/expcetion-tracking-with-sentry/issue_detail.jpg" alt="image"></p>
<p>点击[分享该事件]可以将分享该事件：</p>
<p><img src="/assets/blogImg/expcetion-tracking-with-sentry/share_issue.jpg" alt="image"></p>
<p>以上便是利用sentry记录分析错误日志基本功能。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/16/apache-shiro/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason Li">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/assets/totoro.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jasonli822的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/16/apache-shiro/" itemprop="url">Apache Shiro使用介绍</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-16T15:12:08+08:00">
                2017-02-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Shiro简介"><a href="#Shiro简介" class="headerlink" title="Shiro简介"></a>Shiro简介</h2><ul>
<li>Apache Shiro是Java的一个安全(权限)框架。</li>
<li>Shiro 可以非常容易的开发出足够好的应用，其不仅可以用在JavaSE环境，也可以用在JavaEE的环境。</li>
<li>Shiro可以完成：认证、授权、加密、会话管理、与Web集成、缓存等。</li>
<li>Shiro 官网：<a href="https://shiro.apache.org/" target="_blank" rel="noopener">https://shiro.apache.org/</a><br><img src="/assets/blogImg/shiro/shiro_website.png" alt="image"></li>
</ul>
<h2 id="功能简介"><a href="#功能简介" class="headerlink" title="功能简介"></a>功能简介</h2><p>基本功能点如下图所示：<br><img src="/assets/blogImg/shiro/shiro_features.png" alt="image"></p>
<ul>
<li>Authentication - 身份认证/登录，验证用户是不是拥有相应的身份。</li>
<li>Authorization - 授权，即权限验证，验证某个已认证的用户是否拥有某个权限；即判断用户是否能进行什么操作，如：验证某个用户是否拥有某个角色。或者细粒度的验证某个用户对某个资源是否具有某个权限。</li>
<li>Session Management - 会话管理，即用户登录后就是一次会话，在没有退出之前，它的偶有信息都在会话中；会话可以是普通JavaSE环境，也可以是Web环境的。</li>
<li>Cryptography - 加密，保护数据的安全性，如密码加密存储到数据库，而不是明文存储。</li>
<li>Web Support - Web支持，可以非常容易的集成到Web环境。</li>
<li>Concurrency - Shiro支持多线程应用的并发验证，即如在一个线程中开启另一个线程，能把权限自动传播过去。</li>
<li>Testing - 提供测试支持。</li>
<li>Caching - 缓存，比如用户登录后，其用户信息、拥有的角色/权限不必每次去查，这样可以提高效率。</li>
<li>“Run As” - 允许一个用户假装为另一个用户（如果他们允许）的身份进行访问。</li>
<li>Remember Me - 记住我，这个是非常常见的功能，即一次登录后，下次再来的话不用登录了。</li>
</ul>
<h2 id="Shiro架构-Shiro外部来看"><a href="#Shiro架构-Shiro外部来看" class="headerlink" title="Shiro架构(Shiro外部来看)"></a>Shiro架构(Shiro外部来看)</h2><p>从外部来看Shiro,即从应用程序角度来观察如何使用Shiro完成工作：<br><img src="/assets/blogImg/shiro/shiro_schema.png" alt="image"></p>
<ul>
<li>Application Code - 实际上指的是我们的应用程序</li>
<li>Subject - 应用程序去访问Shiro的话，一定是Subject，这个是表示当前用户，就是说你有没有登录，是不是可以去访问某一个权限，Subject可以理解为一个“门面”</li>
<li>Security Manager - 就像一个大管家，管理着Shiro的各个组件，实际上Subject的背后就是这个Security Manager。</li>
<li>Realm - 当我们需要访问一些安全数据的时候，比如说获取用户信息，获取权限信息我们需要用到Realm，它相当于是一个Security Dao</li>
</ul>
<h2 id="Shiro架构-Shiro内部来看"><a href="#Shiro架构-Shiro内部来看" class="headerlink" title="Shiro架构(Shiro内部来看)"></a>Shiro架构(Shiro内部来看)</h2><p><img src="/assets/blogImg/shiro/shiro_architecture.png" alt="image"></p>
<h2 id="HelloWorld"><a href="#HelloWorld" class="headerlink" title="HelloWorld"></a>HelloWorld</h2><h3 id="1-创建一个Java-Project-取名为-“shiro-helloworld”，"><a href="#1-创建一个Java-Project-取名为-“shiro-helloworld”，" class="headerlink" title="1.创建一个Java Project, 取名为 “shiro-helloworld”，"></a>1.创建一个Java Project, 取名为 “shiro-helloworld”，</h3><p><img src="/assets/blogImg/shiro/shiro_helloworld.png" alt="image"></p>
<h3 id="2-在工程里面新建一个lib的文件夹，将所需的shiro相关jar包拷贝过来"><a href="#2-在工程里面新建一个lib的文件夹，将所需的shiro相关jar包拷贝过来" class="headerlink" title="2.在工程里面新建一个lib的文件夹，将所需的shiro相关jar包拷贝过来"></a>2.在工程里面新建一个lib的文件夹，将所需的shiro相关jar包拷贝过来</h3><p><img src="/assets/blogImg/shiro/shiro_lib.png" alt="image"><br>将jar包加入Build Path</p>
<h3 id="3-看shiro给我们提供的HelloWorld"><a href="#3-看shiro给我们提供的HelloWorld" class="headerlink" title="3.看shiro给我们提供的HelloWorld"></a>3.看shiro给我们提供的HelloWorld</h3><p>Shiro source code 下载地址为：<a href="https://shiro.apache.org/download.html#latestSource" target="_blank" rel="noopener">https://shiro.apache.org/download.html#latestSource</a><br><img src="/assets/blogImg/shiro/shiro_source_code.png" alt="image"><br>我们到shrio source code 的 samples/quickstart 目录下面</p>
<p><img src="/assets/blogImg/shiro/shiro_quickstart_resources.png" alt="image"></p>
<p>将这两个配置文件拷贝到我们的工程下面,</p>
<p><img src="/assets/blogImg/shiro/shiro_quickstart_resources_2.png" alt="image"></p>
<p>然后将Quickstart.java文件拷贝到项目中,<br><img src="/assets/blogImg/shiro/shiro_quickstart_java.png" alt="image"><br>新建一个包 com.shiro.helloworld，将Quickstart.java文件拷入，拷入后，加入包的声明，<br><img src="/assets/blogImg/shiro/shiro_quickstart_java_2.png" alt="image"></p>
<p>右键-&gt;Run As-&gt;Java Application，可以看到系统可以正常跑起来,<br><img src="/assets/blogImg/shiro/shiro_helloworld_run.png" alt="image"></p>
<p>下面我们来解读一下这部分代码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// The easiest way to create a Shiro SecurityManager with configured</span></span><br><span class="line"><span class="comment">// realms, users, roles and permissions is to use the simple INI config.</span></span><br><span class="line"><span class="comment">// We'll do that by using a factory that can ingest a .ini file and</span></span><br><span class="line"><span class="comment">// return a SecurityManager instance:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Use the shiro.ini file at the root of the classpath</span></span><br><span class="line"><span class="comment">// (file: and url: prefixes load from files and urls respectively):</span></span><br><span class="line">Factory&lt;SecurityManager&gt; factory = <span class="keyword">new</span> IniSecurityManagerFactory(<span class="string">"classpath:shiro.ini"</span>);</span><br><span class="line">SecurityManager securityManager = factory.getInstance();</span><br></pre></td></tr></table></figure>
<p>这段代码是指以一种最简单的方式-通过shiro.ini配置文件的方式来获取SecurityManager的一个实例.</p>
<p>shiro.ini文件里面配置了用户，用户密码，用户所有的角色，权限，这里仅仅是HelloWorld应用，实际中相关信息需要从数据库中获取。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// for this simple example quickstart, make the SecurityManager</span></span><br><span class="line"><span class="comment">// accessible as a JVM singleton.  Most applications wouldn't do this</span></span><br><span class="line"><span class="comment">// and instead rely on their container configuration or web.xml for</span></span><br><span class="line"><span class="comment">// webapps.  That is outside the scope of this simple quickstart, so</span></span><br><span class="line"><span class="comment">// we'll just do the bare minimum so you can continue to get a feel</span></span><br><span class="line"><span class="comment">// for things.</span></span><br><span class="line">SecurityUtils.setSecurityManager(securityManager);</span><br></pre></td></tr></table></figure>
<p>在这个简单的例子里，我们使SecurityManager在Java虚拟机里面变为单例模而且是可以访问的。<br>“Most applications wouldn’t do this”，大部分应用都不这样做，所以这段代码我们也不用太关心。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// get the currently executing user:</span></span><br><span class="line">Subject currentUser = SecurityUtils.getSubject();</span><br></pre></td></tr></table></figure>
<p>这段代码是获取当前的Subject</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Do some stuff with a Session (no need for a web or EJB container!!!)</span></span><br><span class="line">Session session = currentUser.getSession();</span><br><span class="line">session.setAttribute(<span class="string">"someKey"</span>, <span class="string">"aValue"</span>);</span><br><span class="line">String value = (String) session.getAttribute(<span class="string">"someKey"</span>);</span><br><span class="line"><span class="keyword">if</span> (value.equals(<span class="string">"aValue"</span>)) &#123;</span><br><span class="line">	log.info(<span class="string">"Retrieved the correct value! ["</span> + value + <span class="string">"]"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试使用Session，注意：即便是在没有Web的容器下也可以测试，在控制台输出中可以看出这个值是可以获取的，<br><img src="/assets/blogImg/shiro/retrieved_the_session_value.png" alt="image"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// let's login the current user so we can check against roles and permissions:</span></span><br><span class="line"><span class="keyword">if</span> (!currentUser.isAuthenticated()) &#123;</span><br><span class="line">	UsernamePasswordToken token = <span class="keyword">new</span> UsernamePasswordToken(<span class="string">"lonestarr"</span>, <span class="string">"vespa"</span>);</span><br><span class="line">	token.setRememberMe(<span class="keyword">true</span>);</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		currentUser.login(token);</span><br><span class="line">	&#125; <span class="keyword">catch</span> (UnknownAccountException uae) &#123;</span><br><span class="line">		log.info(<span class="string">"There is no user with username of "</span> + token.getPrincipal());</span><br><span class="line">	&#125; <span class="keyword">catch</span> (IncorrectCredentialsException ice) &#123;</span><br><span class="line">		log.info(<span class="string">"Password for account "</span> + token.getPrincipal() + <span class="string">" was incorrect!"</span>);</span><br><span class="line">	&#125; <span class="keyword">catch</span> (LockedAccountException lae) &#123;</span><br><span class="line">		log.info(<span class="string">"The account for username "</span> + token.getPrincipal() + <span class="string">" is locked.  "</span> +</span><br><span class="line">				<span class="string">"Please contact your administrator to unlock it."</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// ... catch more exceptions here (maybe custom ones specific to your application?</span></span><br><span class="line">	<span class="keyword">catch</span> (AuthenticationException ae) &#123;</span><br><span class="line">		<span class="comment">//unexpected condition?  error?</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试当前的用户是否已经被认证,即是否已经登录,调用 <code>currentUser.isAuthenticated()</code>方法，这里是没有登录的，</p>
<p><code>UsernamePasswordToken token = new UsernamePasswordToken(&quot;lonestarr&quot;, &quot;vespa&quot;);</code> 把用户名和密码封装为UsernamePasswordToken对象，</p>
<p>调用 <code>currentUser.login(token);</code> 执行登录。 </p>
<p>那么我们能够登录成功吗？ – 取决于shiro.ini这个配置文件中是否配置了lonestarr这个用户，并且配置的密码是vespa。</p>
<p><img src="/assets/blogImg/shiro/shiro_ini_config_user.png" alt="image"></p>
<p>shiro.ini 里面有配置这个用户，用户密码也是一致的，所以可以成功登录。<br><img src="/assets/blogImg/shiro/logged_in_successfully.png" alt="image"></p>
<p>从代码中可以看出，可能出现的异常有：</p>
<ul>
<li>UnknownAccountException  - 未知的账户，若没有指定的账户则shiro将会抛出这个异常；</li>
<li>IncorrectCredentialsException - 错误的凭证异常，若账户存在，但密码不匹配，则shiro会抛出IncorrectCredentialsException异常；</li>
<li>LockedAccountException - 用户被锁定异常；</li>
<li>AuthenticationException - 所有认证时异常的父类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//test a role:</span></span><br><span class="line"><span class="keyword">if</span> (currentUser.hasRole(<span class="string">"schwartz"</span>)) &#123;</span><br><span class="line">	log.info(<span class="string">"May the Schwartz be with you!"</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	log.info(<span class="string">"Hello, mere mortal."</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这段代码用于测试用户是否具有schwartz这个角色，查看shiro.ini配置文件<br><img src="/assets/blogImg/shiro/shiro_ini_config_user_2.png" alt="image"><br>可以看到lonestarr这个用户时拥有schwartz这个角色的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//test a typed permission (not instance-level)</span></span><br><span class="line"><span class="keyword">if</span> (currentUser.isPermitted(<span class="string">"lightsaber:weild"</span>)) &#123;</span><br><span class="line">	log.info(<span class="string">"You may use a lightsaber ring.  Use it wisely."</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	log.info(<span class="string">"Sorry, lightsaber rings are for schwartz masters only."</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这段代码用于测试用户是否具备某个行为。Role(角色)是一个抽象的概率，Rermission(权限)是具体的行为。查看shiro.ini配置文件：<br><img src="/assets/blogImg/shiro/shiro_ini_config_user_permission.png" alt="image"></p>
<p>可以看见用户lonestarr拥有schwartz这个角色，schwartz拥有lightsaber的权限。 * 是通配符，表示匹配任意字符。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//a (very powerful) Instance Level permission:</span></span><br><span class="line"><span class="keyword">if</span> (currentUser.isPermitted(<span class="string">"winnebago:drive:eagle5"</span>)) &#123;</span><br><span class="line">	log.info(<span class="string">"You are permitted to 'drive' the winnebago with license plate (id) 'eagle5'.  "</span> +</span><br><span class="line">			<span class="string">"Here are the keys - have fun!"</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">	log.info(<span class="string">"Sorry, you aren't allowed to drive the 'eagle5' winnebago!"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同上，这段代码也是测试用户是否具备某个行为，不过这个比上面更具体(very powerful)。<br><img src="/assets/blogImg/shiro/shiro_ini_config_user_permission_2.png" alt="image"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># The &apos;goodguy&apos; role is allowed to &apos;drive&apos; (action) the winnebago (type) with</span><br><span class="line"># license plate &apos;eagle5&apos; (instance specific id)</span><br></pre></td></tr></table></figure>
<p>winnebago - 表示的一个类型(type)， drive - 表示一个具体的行为(action)， eagle5 - 表示一个具体的Id。<br>比如字符串 user:delete:zhangsan， 表示具备删除张三这个用户的权限。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//all done - log out!</span></span><br><span class="line">currentUser.logout();</span><br></pre></td></tr></table></figure>
<p>最后，执行登出，程序结束。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/02/15/node-with-express-and-ejs/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason Li">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/assets/totoro.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jasonli822的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/02/15/node-with-express-and-ejs/" itemprop="url">nodejs+express+ejs简单示例</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-15T17:15:19+08:00">
                2017-02-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/nodejs/" itemprop="url" rel="index">
                    <span itemprop="name">nodejs</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近因为工作需要在学习Node.js，简单的搭建了一个nodejs+express+ejs示例，记录一下。</p>
<h6 id="环境和知识准备："><a href="#环境和知识准备：" class="headerlink" title="环境和知识准备："></a>环境和知识准备：</h6><p>环境搭建<br>Node.js的安装省略，网上有很多教程。</p>
<p>参考文档：<br>Node.js 教程 | 菜鸟教程 <a href="http://www.runoob.com/nodejs/nodejs-tutorial.html" target="_blank" rel="noopener">http://www.runoob.com/nodejs/nodejs-tutorial.html</a><br>Express - 基于 Node.js 平台的 web 应用开发框架 <a href="http://www.expressjs.com.cn/" target="_blank" rel="noopener">http://www.expressjs.com.cn/</a><br>EJS – Embedded JavaScript templates <a href="http://ejs.co/" target="_blank" rel="noopener">http://ejs.co/</a></p>
<p>本文参考 Use EJS to Template Your Node Application | Scotch <a href="https://scotch.io/tutorials/use-ejs-to-template-your-node-application" target="_blank" rel="noopener">https://scotch.io/tutorials/use-ejs-to-template-your-node-application</a> 这篇文章搭建的示例，IDE使用的是Visual Studio Code <a href="https://code.visualstudio.com/。" target="_blank" rel="noopener">https://code.visualstudio.com/。</a></p>
<h3 id="文件结构"><a href="#文件结构" class="headerlink" title="文件结构"></a>文件结构</h3><p>在磁盘上创建文件夹node-with-express-and-ejs,在该文件夹下面创建以下文件夹和文件，完成后的文件结构如下：</p>
<p><img src="/assets/blogImg/nodejs/node-with-express-and-ejs/file_structure.png" alt="image"></p>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>打开package.json这个项目配置文件，添加对express和ejs的依赖</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"node-ejs"</span>,</span><br><span class="line">  <span class="attr">"main"</span>: <span class="string">"server.js"</span>,</span><br><span class="line">  <span class="attr">"dependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"ejs"</span>: <span class="string">"^1.0.0"</span>,</span><br><span class="line">    <span class="attr">"express"</span>: <span class="string">"^4.6.1"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来使用npm install命令进行安装：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install</span><br></pre></td></tr></table></figure>
<p><img src="/assets/blogImg/nodejs/node-with-express-and-ejs/npm_install.png" alt="image"></p>
<p>编辑server.js文件，增加如下代码：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="comment">// load the things we need</span></span><br><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">// set the view engine to ejs</span></span><br><span class="line">app.set(<span class="string">'view engine'</span>, <span class="string">'ejs'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// use res.render to load up an ejs view file</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// index page </span></span><br><span class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.render(<span class="string">'pages/index'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// about page </span></span><br><span class="line">app.get(<span class="string">'/about'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.render(<span class="string">'pages/about'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'3000 is the magic port'</span>);</span><br></pre></td></tr></table></figure></p>
<h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><p>使用 $ node server.js 命令启动服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ node server.js</span><br></pre></td></tr></table></figure></p>
<p>启动成功后，我们就可以在浏览器中访问：<a href="http://127.0.0.1:3000/" target="_blank" rel="noopener">http://127.0.0.1:3000/</a> 和 <a href="http://127.0.0.1:3000/about" target="_blank" rel="noopener">http://127.0.0.1:3000/about</a> 了。</p>
<h3 id="利用EJS-Partials编写公用的模板文件"><a href="#利用EJS-Partials编写公用的模板文件" class="headerlink" title="利用EJS Partials编写公用的模板文件"></a>利用EJS Partials编写公用的模板文件</h3><p>views/partials/head.ejs<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- views/partials/head.ejs --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Super Awesome<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- CSS (load bootstrap from a CDN) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">href</span>=<span class="string">"//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="undefined">    body    &#123; padding-top:50px; &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>views/partials/header.ejs<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- views/partials/header.ejs --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">"navbar navbar-default"</span> <span class="attr">role</span>=<span class="string">"navigation"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container-fluid"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"navbar-header"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"navbar-brand"</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"glyphicon glyphicon glyphicon-tree-deciduous"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">                EJS Is Fun</span><br><span class="line">            <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/"</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/about"</span>&gt;</span>About<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">      </span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>views/partials/footer.ejs<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- views/partials/footer.ejs --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">"text-center text-muted"</span>&gt;</span>© Copyright 2014 The Awesome People<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="使用include标签引入公用的模板"><a href="#使用include标签引入公用的模板" class="headerlink" title="使用include标签引入公用的模板"></a>使用include标签引入公用的模板</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- views/pages/index.ejs --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">%</span> <span class="attr">include</span> <span class="attr">..</span>/<span class="attr">partials</span>/<span class="attr">head</span> %&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">header</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">%</span> <span class="attr">include</span> <span class="attr">..</span>/<span class="attr">partials</span>/<span class="attr">header</span> %&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">main</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"jumbotron"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>This is great<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>Welcome to templating using EJS<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">footer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">%</span> <span class="attr">include</span> <span class="attr">..</span>/<span class="attr">partials</span>/<span class="attr">footer</span> %&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>修改完成后，再次访问首页，页面如下所示：<br><img src="/assets/blogImg/nodejs/node-with-express-and-ejs/index_page.png" alt="image"></p>
<p>修改about页面<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- views/pages/about.ejs --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">%</span> <span class="attr">include</span> <span class="attr">..</span>/<span class="attr">partials</span>/<span class="attr">head</span> %&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">header</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">%</span> <span class="attr">include</span> <span class="attr">..</span>/<span class="attr">partials</span>/<span class="attr">header</span> %&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">main</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-8"</span>&gt;</span></span><br><span class="line">            </span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"jumbotron"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>This is great<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">p</span>&gt;</span>Welcome to templating using EJS<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">                </span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-sm-4"</span>&gt;</span></span><br><span class="line">                </span><br><span class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"well"</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>Look I'm A Sidebar!<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">main</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">footer</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">%</span> <span class="attr">include</span> <span class="attr">..</span>/<span class="attr">partials</span>/<span class="attr">footer</span> %&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>访问about页面：<br><img src="/assets/blogImg/nodejs/node-with-express-and-ejs/about_page.png" alt="image"></p>
<p>下面我们看看如何传递数据到页面(实际生产环境中我们应该从数据库中获取数据)：</p>
<p>打开server.js，修改app.get(‘/‘)这个路由，增加一些模拟数据：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// index page </span></span><br><span class="line">app.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> drinks = [</span><br><span class="line">        &#123; <span class="attr">name</span>: <span class="string">'Bloody Mary'</span>, <span class="attr">drunkness</span>: <span class="number">3</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">name</span>: <span class="string">'Martini'</span>, <span class="attr">drunkness</span>: <span class="number">5</span> &#125;,</span><br><span class="line">        &#123; <span class="attr">name</span>: <span class="string">'Scotch'</span>, <span class="attr">drunkness</span>: <span class="number">10</span> &#125;</span><br><span class="line">    ];</span><br><span class="line">    <span class="keyword">var</span> tagline = <span class="string">"Any code of your own that you haven't looked at for six or more months might as well have been written by someone else."</span>;</span><br><span class="line"></span><br><span class="line">    res.render(<span class="string">'pages/index'</span>, &#123;</span><br><span class="line">        drinks: drinks,</span><br><span class="line">        tagline: tagline</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>修改index.ejs文件，利用&lt;%=%&gt;标签(和JSP中的标签类似)来显示变量的数据：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- views/pages/index.ejs --&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>Variable<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">%=</span> <span class="attr">tagline</span> %&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>使用 .forEach来遍历数据：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- views/pages/index.ejs --&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>Loop<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">%</span> <span class="attr">drinks.forEach</span>(<span class="attr">function</span>(<span class="attr">drink</span>) &#123; %&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">%=</span> <span class="attr">drink.name</span> %&gt;</span> - <span class="tag">&lt;<span class="name">%=</span> <span class="attr">drink.drunkness</span> %&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">%</span> &#125;); %&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>修改后的index.ejs文件如下：<br><img src="/assets/blogImg/nodejs/node-with-express-and-ejs/index_page_with_data.png" alt="image"></p>
<p>再次访问首页，可以发现数据已经传递到页面了：<br><img src="/assets/blogImg/nodejs/node-with-express-and-ejs/index_page_view_with_data.png" alt="image"></p>
<p>至此，一个简单的nodejs+express+ejs示例就完成了。</p>
<p>后记：代码编写过程中发现VSCode不支持ejs后缀的文件的语法高亮显示，解决方案如下：<br>参考文档：Add .EJS support or extend existing HTML to include .EJS <a href="https://github.com/Microsoft/vscode/issues/2853" target="_blank" rel="noopener">https://github.com/Microsoft/vscode/issues/2853</a><br><img src="/assets/blogImg/nodejs/node-with-express-and-ejs/vscode_ejs_support.png" alt="image"></p>
<p>修改完成后，重启VSCode，发现index.ejs文件里面的html也可以高亮显示如，如下所示：<br><img src="/assets/blogImg/nodejs/node-with-express-and-ejs/vscode_ejs_support_2.png" alt="image"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/09/30/heritrix-basic/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason Li">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/assets/totoro.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jasonli822的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/30/heritrix-basic/" itemprop="url">Heritrix环境安装</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-09-30T08:30:04+08:00">
                2016-09-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/crawler/" itemprop="url" rel="index">
                    <span itemprop="name">crawler</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>Heritrix is the Internet Archive’s open-source, extensible, web-scale, archival-quality web crawler project.</p>
</blockquote>
<h2 id="一、源码下载"><a href="#一、源码下载" class="headerlink" title="一、源码下载"></a>一、源码下载</h2><p>访问GitHub地址：<a href="https://github.com/internetarchive/heritrix3" target="_blank" rel="noopener">https://github.com/internetarchive/heritrix3</a></p>
<p><img src="/assets/blogImg/heritrix/heritrix-github.png" alt="image"></p>
<p>我这里采用Clone的方式，使用的IDE是IntelliJ IDEA</p>
<p><img src="/assets/blogImg/heritrix/chekout-from-github.png" alt="image"></p>
<p><img src="/assets/blogImg/heritrix/clone_repository.png" alt="image"></p>
<p>导入完成后的结果如下：<br><img src="/assets/blogImg/heritrix/project-structure.png" alt="image"></p>
<h2 id="二、启动Heritrix"><a href="#二、启动Heritrix" class="headerlink" title="二、启动Heritrix"></a>二、启动Heritrix</h2><p><a href="https://webarchive.jira.com/wiki/display/Heritrix/Running+Heritrix+3.0+and+3.1" target="_blank" rel="noopener">https://webarchive.jira.com/wiki/display/Heritrix/Running+Heritrix+3.0+and+3.1</a></p>
<p>尝试启动heritrix，heritrix内核使用jetty所以不需要依附tomcat或者其他web容器。<br>入口类是这个 org.archive.crawler.Heritrix，设置启动参数，如下所示：</p>
<p><img src="/assets/blogImg/heritrix/create_configuration_for_heritrix.png" alt="image"></p>
<p>右键 Run ‘Heritrix.main()’启动程序：</p>
<p><img src="/assets/blogImg/heritrix/run_heritrix.png" alt="image"></p>
<p>启动成功：<br><img src="/assets/blogImg/heritrix/run_heritrix_success.png" alt="image"></p>
<h2 id="三、基于Web的用户界面"><a href="#三、基于Web的用户界面" class="headerlink" title="三、基于Web的用户界面"></a>三、基于Web的用户界面</h2><p>After Heritrix has been launched, the Web-based user interface (WUI) becomes accessible.<br>The URI to access the Web UI is typically<br>https://(heritrixhost):8443</p>
<p>打开浏览器，访问 <a href="https://localhost:8443/" target="_blank" rel="noopener">https://localhost:8443/</a> ,输入用户名密码，admin,admin。</p>
<p><img src="/assets/blogImg/heritrix/access_heritrix.png" alt="image"></p>
<p>登录成功后的主控制台页如下所示：</p>
<p><img src="/assets/blogImg/heritrix/heritrix-web.png" alt="image"></p>
<h2 id="四、运行第一个爬虫任务的快速指南"><a href="#四、运行第一个爬虫任务的快速指南" class="headerlink" title="四、运行第一个爬虫任务的快速指南"></a>四、运行第一个爬虫任务的快速指南</h2><p>在主控制台页，新建一个名为’myJob’的Job，创建成功后的界面如下：</p>
<p><img src="/assets/blogImg/heritrix/create_job.png" alt="image"></p>
<p>点击新创建的’myJob’的名称链接，进入到’myJob’管理界面，如下所示：</p>
<p><img src="/assets/blogImg/heritrix/myjob.png" alt="image"></p>
<p>单击工具栏上的”Configuration”链接，进入配置文件的展示/编辑页面如下所示：</p>
<p><img src="/assets/blogImg/heritrix/crawler-beans.png" alt="image"></p>
<p>需要进行一些简单的配置，才能使得这个Job正常运行：<br>A. 将一个有效的值添加到 metadata.operatorContactUrl 属性，如下所示：</p>
<p><img src="/assets/blogImg/heritrix/metadata.operatorContactUrl.png" alt="image"></p>
<p>1)metadata.operatorContactUrl   你控制Heritrix的URL,一般是<a href="http://127.0.0.1" target="_blank" rel="noopener">http://127.0.0.1</a><br>2)metadata.jobName 表示你的抓取名字,我们刚才创建的是myjob,那就修改为myjob<br>3)metadata.description 表示对这个抓取任务的简单描述,我们这里就描述为 firt crawl job</p>
<p>B. 接下来，修改爬虫的种子值 longerOverrides 的 <prop>元素, 这里设置你想抓取的种子.</prop></p>
<p><img src="/assets/blogImg/heritrix/longerOverrides.png" alt="image"></p>
<p>C. 完善job信息和本机信息</p>
<p><img src="/assets/blogImg/heritrix/job_info.png" alt="image"></p>
<p>修改完成后，点击左下角的’save changes’按钮，保存配置。</p>
<p><img src="/assets/blogImg/heritrix/save_changes.png" alt="image"></p>
<p>保存成功后，返回到’myJob’管理界面：</p>
<p><img src="/assets/blogImg/heritrix/myjob_web.png" alt="image"></p>
<p>点击’build’按钮，进行build，Job is Ready<br>点击’Launch’按钮, Job is Active:PREPARING<br>点击’checkpoint’按钮, Job is Active:PAUSED<br>点击’unpause’按钮，运行Job，Job is Active:RUNNING</p>
<p>进入文件目录，我们可以看到文件保存的目录<br>D:\workspace\github\heritrix3\jobs\myjob\20160825031757\warcs 在不断的增大。</p>
<p>如果要看到每个抓取的页面，可以将配置文件的warcWriter这个bean的class改为：<br>org.archive.modules.writer.MirrorWriterProcessor，这样就下载的网页是以镜像文件的形式保存在，一般存放在项目根目录下的mirror目录下。</p>
<h2 id="五、部署到Linux系统"><a href="#五、部署到Linux系统" class="headerlink" title="五、部署到Linux系统"></a>五、部署到Linux系统</h2><p>export JAVA_OPTS=-Xmx1724M<br>./heritrix -a admin:admin -b 192.168.8.225</p>
<h2 id="六、参考资料"><a href="#六、参考资料" class="headerlink" title="六、参考资料"></a>六、参考资料</h2><p>Heritrix3.0教程(三) 开始抓取 <a href="http://guoyunsky.iteye.com/blog/1744456" target="_blank" rel="noopener">http://guoyunsky.iteye.com/blog/1744456</a><br>搜索引擎搭建——Heritrix  <a href="http://blog.wuzx.me/archives/368" target="_blank" rel="noopener">http://blog.wuzx.me/archives/368</a><br>Heritrix中的SURT和SurtPrefixedDecideRule .<br><a href="http://cache.baiducontent.com/c?m=9f65cb4a8c8507ed4fece7631046893b4c4380146d96864968d4e414c4224615023dbfee3a715042889422301cf91e1ab9ab68332a0420b190ca8b4cc9fecf6879877d633047c00149990eafba07628166875b99ed59b0eeab78c4f8c5d2af02049b08532d97f1fb1a474a9d&amp;p=8f769a4780d501f010bd9b7a0757&amp;newp=8b2a971a878511a05ce7822a130a92695803ed603ed4d501298ffe0cc4241a1a1a3aecbf26221006d3c1786501af4e57edf63271340234f1f689df08d2ecce7e70d961&amp;user=baidu&amp;fm=sc&amp;query=Heritrix+SurtPrefixedDecideRule&amp;qid=97273cbc0000dbe4&amp;p1=1" target="_blank" rel="noopener">http://cache.baiducontent.com/c?m=9f65cb4a8c8507ed4fece7631046893b4c4380146d96864968d4e414c4224615023dbfee3a715042889422301cf91e1ab9ab68332a0420b190ca8b4cc9fecf6879877d633047c00149990eafba07628166875b99ed59b0eeab78c4f8c5d2af02049b08532d97f1fb1a474a9d&amp;p=8f769a4780d501f010bd9b7a0757&amp;newp=8b2a971a878511a05ce7822a130a92695803ed603ed4d501298ffe0cc4241a1a1a3aecbf26221006d3c1786501af4e57edf63271340234f1f689df08d2ecce7e70d961&amp;user=baidu&amp;fm=sc&amp;query=Heritrix+SurtPrefixedDecideRule&amp;qid=97273cbc0000dbe4&amp;p1=1</a></p>
<p>RE: [archive-crawler] Inserting information to MYSQL during crawl<br><a href="https://groups.yahoo.com/neo/groups/archive-crawler/conversations/topics/508" target="_blank" rel="noopener">https://groups.yahoo.com/neo/groups/archive-crawler/conversations/topics/508</a></p>
<p>写入HBase<br><a href="https://github.com/OpenSourceMasters/hbase-writer" target="_blank" rel="noopener">https://github.com/OpenSourceMasters/hbase-writer</a></p>
<p>SURT+Rules<br><a href="https://webarchive.jira.com/wiki/display/ARIH/SURT+Rules" target="_blank" rel="noopener">https://webarchive.jira.com/wiki/display/ARIH/SURT+Rules</a><br><a href="https://webarchive.jira.com/wiki/display/ARIH/Expand+Scope+Rules" target="_blank" rel="noopener">https://webarchive.jira.com/wiki/display/ARIH/Expand+Scope+Rules</a></p>
<p>Heritrix3.0教程(五) 配置文件crawler-beans.cxml介绍<br><a href="http://guoyunsky.iteye.com/blog/1744461" target="_blank" rel="noopener">http://guoyunsky.iteye.com/blog/1744461</a></p>
<p>Heritrix 3.x API Guide<br><a href="https://webarchive.jira.com/wiki/display/Heritrix/Heritrix+3.x+API+Guide#Heritrix3.xAPIGuide-LaunchJob" target="_blank" rel="noopener">https://webarchive.jira.com/wiki/display/Heritrix/Heritrix+3.x+API+Guide#Heritrix3.xAPIGuide-LaunchJob</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/07/09/springmvc-framework-8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason Li">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/assets/totoro.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jasonli822的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/07/09/springmvc-framework-8/" itemprop="url">使用IntelliJ IDEA开发SpringMVC网站（八）log4jdbc-remix使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-07-09T13:50:04+08:00">
                2016-07-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在<a href="/2016/06/29/springmvc-framework-4/">《使用IntelliJ IDEA开发SpringMVC网站（四）集成MyBatis》</a>文章中讲解了使用Log4j来输出MyBatis执行的SQL语句，如下所示：</p>
<p><img src="/assets/blogImg/springmvc/frame_4_home_page_output_sql2.png" alt="image"></p>
<p>这里有一个缺点：<strong>占位符与参数是分开打印</strong>的，如果想要拷贝sql至客户端直接执行，需要自己拼凑sql。而log4jdbc是在jdbc层的一个日志框架，可以将占位符与参数全部合并在一起显示，方便直接拷贝sql在客户端直接执行，加快调试速度。</p>
<p>log4jdbc-remix 是 log4jdbc的一个扩展，安装配置过程如下:</p>
<h2 id="1-加入依赖的Jar包"><a href="#1-加入依赖的Jar包" class="headerlink" title="1.加入依赖的Jar包"></a>1.加入依赖的Jar包</h2><p>在pom.xml文件中增加如下内容：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line">	<span class="tag">&lt;<span class="name">log4jdbc_remix.version</span>&gt;</span>0.2.7<span class="tag">&lt;/<span class="name">log4jdbc_remix.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line">	<span class="comment">&lt;!-- log4jdbc-remix --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.lazyluke<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4jdbc-remix<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;log4jdbc_remix.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="2-Spring中配置"><a href="#2-Spring中配置" class="headerlink" title="2.Spring中配置"></a>2.Spring中配置</h2><p>修改spring-mybatis.xml文件，配置如下所示：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--数据库连接池--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSourceSpied"</span> <span class="attr">class</span>=<span class="string">"com.alibaba.druid.pool.DruidDataSource"</span> <span class="attr">init-method</span>=<span class="string">"init"</span> <span class="attr">destroy-method</span>=<span class="string">"close"</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.url&#125;"</span> /&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.username&#125;"</span>/&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;jdbc.password&#125;"</span>/&gt;</span></span><br><span class="line">	  <span class="comment">&lt;!-- 配置初始化大小、最小、最大 --&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"initialSize"</span>&gt;</span><span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxActive"</span>&gt;</span><span class="tag">&lt;<span class="name">value</span>&gt;</span>20<span class="tag">&lt;/<span class="name">value</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"minIdle"</span>&gt;</span><span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	  <span class="comment">&lt;!-- 配置获取连接等待超时的时间 --&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxWait"</span>&gt;</span><span class="tag">&lt;<span class="name">value</span>&gt;</span>60000<span class="tag">&lt;/<span class="name">value</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	  <span class="comment">&lt;!-- 配置监控统计拦截的filters --&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"filters"</span>&gt;</span><span class="tag">&lt;<span class="name">value</span>&gt;</span>stat<span class="tag">&lt;/<span class="name">value</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	  <span class="comment">&lt;!-- 配置间隔多久才进行一次检测，检测需要关闭的空闲连接，单位是毫秒 --&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"timeBetweenEvictionRunsMillis"</span>&gt;</span><span class="tag">&lt;<span class="name">value</span>&gt;</span>60000<span class="tag">&lt;/<span class="name">value</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	  <span class="comment">&lt;!-- 配置一个连接在池中最小生存的时间，单位是毫秒 --&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"minEvictableIdleTimeMillis"</span>&gt;</span><span class="tag">&lt;<span class="name">value</span>&gt;</span>300000<span class="tag">&lt;/<span class="name">value</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"net.sf.log4jdbc.Log4jdbcProxyDataSource"</span>&gt;</span></span><br><span class="line">	  <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">"dataSourceSpied"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>也可以格式化一下输出如下所示：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"net.sf.log4jdbc.Log4jdbcProxyDataSource"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">ref</span>=<span class="string">"dataSourceSpied"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"logFormatter"</span>&gt;</span> </span><br><span class="line">      <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"net.sf.log4jdbc.tools.Log4JdbcCustomFormatter"</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"loggingType"</span> <span class="attr">value</span>=<span class="string">"MULTI_LINE"</span> /&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"margin"</span> <span class="attr">value</span>=<span class="string">"19"</span> /&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sqlPrefix"</span> <span class="attr">value</span>=<span class="string">"SQL:::"</span> /&gt;</span> </span><br><span class="line">      <span class="tag">&lt;/<span class="name">bean</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="3-log4j-properties配置"><a href="#3-log4j-properties配置" class="headerlink" title="3.log4j.properties配置"></a>3.log4j.properties配置</h2><p>在log4j.properties文件里面增加如下内容：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">##-------------log4jdbc 配置方式示例---------------##</span><br><span class="line">#值设置方式 ：如果关闭设置为OFF，如果开启设置为ON(默认debug级别)或(设置输出级别,输出器)</span><br><span class="line">log4j.logger.jdbc.sqlonly=OFF</span><br><span class="line">log4j.logger.jdbc.sqltiming=INFO,sql</span><br><span class="line">log4j.logger.jdbc.audit=OFF</span><br><span class="line">log4j.logger.jdbc.resultset=OFF</span><br><span class="line">log4j.logger.jdbc.connection=OFF</span><br><span class="line">log4j.logger.jdbc.resultsettable=INFO,sql</span><br><span class="line"></span><br><span class="line">log4j.additivity.jdbc.sqlonly=false</span><br><span class="line">log4j.additivity.jdbc.sqltiming=false</span><br><span class="line">log4j.additivity.jdbc.audidt=false</span><br><span class="line">log4j.additivity.jdbc.resultset=false</span><br><span class="line">log4j.additivity.jdbc.connection=false</span><br><span class="line">log4j.additivity.jdbc.resultsettable=false</span><br><span class="line"></span><br><span class="line">! the appender used for the JDBC API layer call logging above, sql only</span><br><span class="line">log4j.appender.sql=org.apache.log4j.FileAppender</span><br><span class="line">log4j.appender.sql.File=D:/logs/sql.log</span><br><span class="line">log4j.appender.sql.Append=false</span><br><span class="line">log4j.appender.sql.layout=org.apache.log4j.PatternLayout</span><br><span class="line">log4j.appender.sql.layout.ConversionPattern= %d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; %m%n%n</span><br><span class="line">log4j.additivity.sql=false</span><br></pre></td></tr></table></figure></p>
<p>配置完成，启动服务，出现了以下异常：</p>
<p><img src="/assets/blogImg/springmvc/log4jdbc-remix-formatter-exception.png" alt="image"></p>
<p>解决方案：注释掉 <property name="margin" value="19"> 这行即可。再次启动服务，可以在指定的日志文件 log4j.appender.sql.File=D:/logs/sql.log 查看到打印出的SQL语句：</property></p>
<p><img src="/assets/blogImg/springmvc/log4jdbc-remix-sql-log-file.png" alt="image"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/07/08/springmvc-framework-7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason Li">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/assets/totoro.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jasonli822的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/07/08/springmvc-framework-7/" itemprop="url">使用IntelliJ IDEA开发SpringMVC网站（七）添加REST功能</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-07-08T08:41:05+08:00">
                2016-07-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在上一篇<a href="/2016/07/01/springmvc-framework-6/">《使用IntelliJ IDEA开发SpringMVC网站（六）利用mybatis-generator自动生成代码》</a>文章中讲解了如何利用mybatis-generator自动生成代码，本文讲解一下添加REST功能。</p>
<p><strong>rest(一种软件架构风格)</strong></p>
<p>&emsp;&emsp;REST即表述性状态传递（英文：Representational State Transfer，简称REST）是Roy Fielding博士在2000年他的博士论文中提出来的一种软件架构风格。它是一种针对网络应用的设计和开发方式，可以降低开发的复杂性，提高系统的可伸缩性。</p>
<p>&emsp;&emsp;目前在三种主流的Web服务实现方案中，因为REST模式的Web服务与复杂的SOAP和XML-RPC对比来讲明显的更加简洁，越来越多的web服务开始采用REST风格设计和实现。</p>
<p>&emsp;&emsp;为了帮助Spring开发人员使用REST架构模式，Spring3.0封装了对REST的良好支持。</p>
<p><strong>REST基本原理</strong> </p>
<p>(以下内容摘自《Spring 实战 第3版》)<br>&emsp;&emsp;当谈论REST时，有一种常见的错误就是将其视为“基于URL的Web服务”———将REST作为另一种类型的远程过程调用(Remote Procedure Call, RPC)机制，就像SOAP一样，只不过是通过简单的HTTP URL而不是SOAP的大量XML命名空间来触发。</p>
<p>&emsp;&emsp;恰好相反，REST与RPC几乎没有任何关系。RPC是面向服务的，并关注于行为和动作；而REST是面向资源的，强调描述应用程序的事务和名词。</p>
<p>&emsp;&emsp;此外，尽管URL在REST中起了关键作用，但他们仅仅是整体的一部分而已。为了理解REST是什么，我们将它的首字母缩写拆分为不同的组成部分。</p>
<ul>
<li>表述性(Representational)——REST资源实际上可以用各种形式来进行表述，包括XML、JSON(JavaScript Object Notation)甚至HTML-最适合资源使用者的任意形式。</li>
<li>状态(State)——当使用REST的时候，我们更关注资源的状态而不是对资源采取的行为。</li>
<li>转移(Transfer)——REST涉及转移资源数据，它以某一种表述性形式从一个应用转移到了一个应用。</li>
</ul>
<p>&emsp;&emsp;更简洁地讲，<font color="red">REST就是将资源的状态以最合适的形式从服务器端转移到客户端（或者反之）。</font></p>
<p><strong>Spring是如何支持REST的</strong></p>
<p>&emsp;&emsp;Spring3对Spring MVC的一些增强功能为REST提供了良好的支持。现在，Spring支持以下方式来开发REST资源。</p>
<ul>
<li>控制器可以处理所有的HTTP方法，包含4个主要的REST方法：GET、PUT、DELETE以及POST。</li>
<li>新的@PathVariable注解使得控制器能够处理参数化的URL(将变量输入作为URL的一部分)</li>
<li>Spring表单绑定JSP标签库的<a href="form:form" target="_blank" rel="noopener">form:form</a>标签以及新的HiddenHttpMethodFilter,使得通过HTML表单提交PUT和DELETE请求成为可能，即便在某些浏览器中不支持这些HTTP方法。</li>
<li>通过使用Spring的视图和视图解析器，资源可以以各种形式进行表述，包括将模型数据表现为XML、JSON、Atom和RSS的新视图实现。</li>
<li>可以使用新的ContentNegotiatingViewResolver来选择最适合客户端的表述。</li>
<li>基于视图的渲染可以使用新的@ResponseBody注解和各种HTTPMethodConverter实现来达到。</li>
<li>类似地，新的@ResponseBody注解以及HttpMethodConverter实现可以将传入的HTTP数据转化为传入控制器处理方法的Java对象。</li>
<li>RestTemplate简化了客户端对REST资源的使用。</li>
</ul>
<p><strong>编写面向资源的控制器</strong></p>
<p>&emsp;&emsp;编写Spring MVC控制器类的模型是相当灵活的。几乎所有签名的方法都可以用来处理Web请求。但是这种灵活性的一个副作用据说SPring MVC允许你开发出不符合RESTful资源的控制器。编写出的控制器很容易是RESTless的。</p>
<p><strong>剖析RESTless的控制器</strong></p>
<p>&emsp;&emsp;我们先看一下RESTless控制器究竟长什么样子，这有助于我们理解RESTfult控制器。DisplayUserController就是一个RESTless的控制器，如下所示：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/displayUser.htm"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DisplayUserController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(method = RequestMethod.GET)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">displayUser</span><span class="params">(@RequestParam(required = <span class="keyword">false</span>, defaultValue = <span class="string">"1"</span>)</span> <span class="keyword">int</span> id, Model model) </span>&#123;</span><br><span class="line">        model.addAttribute(userService.findById(id));</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"user/view"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>&emsp;&emsp;首先要关注的第一件事是这个类的名字。确实，它只是一个名字而已。但是，它准确表达了这个控制器是做什么的。第一个单词是Display——一个动词。这表明这个控制器是面向行为的，而不是面向资源的。</p>
<p>&emsp;&emsp;注意类级别的@RequestMapping注解。它说明这个控制器会处理”displayUser.htm”的请求，这似乎表明这个控制器关注于展现User(这里通过类名可以得到确认)的特殊用例。另外，扩展名说明它只能以HTML的形式来展现列表。</p>
<p>&emsp;&emsp;DisplayUserController的编写方式并没有严重的错误。但是，它并不是一个RESTful的控制器。它是面向行为的并关注于一个特殊的用例：以HTML的形式展现一个User对象的详细信息。</p>
<p><strong>处理RESTful URL</strong></p>
<p>&emsp;&emsp;当开始使用REST的时候，很多人想到的第一件事通常是URL。毕竟，在REST中所有的事情都是通过URL完成的。<br><strong>URL是统一资源定位符(uniform resource locator)</strong>的缩写，按照这个名字，URL本意是用于定位资源的。此外，所有的URL同时也都是<strong>URI</strong>或<strong>统一资源标识符(uniform resource identifier)</strong>。如果是这样的话，我们可以认为任何给定的URL不仅可以定位一个资源还可以用于标识一个资源。<br>不同于RESTless URL(<a href="http://localhost:8080/SpringMVCDemo/displayUser.htm?id=2)，" target="_blank" rel="noopener">http://localhost:8080/SpringMVCDemo/displayUser.htm?id=2)，</a> RESTful完成承认HTTP用于表示资源的。 例如：<a href="http://localhost:8080/SpringMVCDemo/users/2" target="_blank" rel="noopener">http://localhost:8080/SpringMVCDemo/users/2</a></p>
<ul>
<li><a href="http://localhost:8080" target="_blank" rel="noopener">http://localhost:8080</a> 标识了域和端口。</li>
<li><a href="http://localhost:8080/SpringMVCDemo" target="_blank" rel="noopener">http://localhost:8080/SpringMVCDemo</a> 标识了应用程序的Servlet上下文。这个URL更具体了，它指明了运行在服务器上的一个应用程序。</li>
<li><a href="http://localhost:8080/SpringMVCDemo/users" target="_blank" rel="noopener">http://localhost:8080/SpringMVCDemo/users</a> 表明了一种资源，也就是SpringMVCDemo应用程序中User的对象列表</li>
<li>：<a href="http://localhost:8080/SpringMVCDemo/users/2" target="_blank" rel="noopener">http://localhost:8080/SpringMVCDemo/users/2</a> 是最精确的URL，标识了一个特定的User资源</li>
</ul>
<p><strong>添加REST功能</strong></p>
<p>关于REST需要讲解的知识很多，这里就不一一详细介绍了，下面我们直接用一个例子来看看Spring MVC对REST的支持吧。</p>
<p>例子达到的效果是，根据不同的URL返回不同的View：</p>
<p><a href="http://localhost:8080/users/2" target="_blank" rel="noopener">http://localhost:8080/users/2</a> 返回默认的视图（FreeMarker）</p>
<p><a href="http://localhost:8080/users/2.json" target="_blank" rel="noopener">http://localhost:8080/users/2.json</a> 返回JSON</p>
<p><a href="http://localhost:8080/users/2.xml" target="_blank" rel="noopener">http://localhost:8080/users/2.xml</a> 返回XML</p>
<p><strong>1.添加依赖</strong><br>在pom.xml里面添加以下依赖：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">...</span><br><span class="line"><span class="tag">&lt;<span class="name">jackson.version</span>&gt;</span>2.7.5<span class="tag">&lt;/<span class="name">jackson.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">jackson_mapper.version</span>&gt;</span>1.9.13<span class="tag">&lt;/<span class="name">jackson_mapper.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">&lt;!-- Needed for JSON View --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jackson.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jackson.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.codehaus.jackson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-mapper-asl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;jackson_mapper.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Needed for XML View (with JAXB2) --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-oxm<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>使用JAXB2.0实现OXM</p>
<blockquote>
<p>OXM是Object XML Mapping的缩写，它是一个O/M-mapper，将java对象映射成XML数据，或者将XML数据映射成java对象。我们把对象与关系数据库之间的映射称为ORM, 所以也把对象与XML之间的映射称为OXM。</p>
</blockquote>
<blockquote>
<p>JAXB（Java Architecture for XML Binding）是一种特殊的序列化/反序列化工具。它可以使XML数据以Java Objects的形式直接应用于Java程序之中，使Java Objects与XML数据之间的转换成为可能。在JAXB中将Java Objects到XML数据的转换称为marshal；XML数据到Java Objects的转换称为unmarshal。原来JAXB是Java EE的一部分，在JDK6中，SUN将其放到了Java SE中，这也是SUN的一贯做法。JDK6中自带的这个JAXB版本是2.0, 比起1.0(JSR 31)来，JAXB2(JSR 222)用JDK5的新特性Annotation来标识要作绑定的类和属性等，这就极大简化了开发的工作量。</p>
</blockquote>
<p>更多介绍参考：<a href="http://my.oschina.net/zzx0421/blog/98186" target="_blank" rel="noopener">http://my.oschina.net/zzx0421/blog/98186</a> </p>
<p><strong>2.Model</strong><br>修改User，使用@XmlRootElement JAXB注解，@XmlRootElement 将一个Java类映射为一段XML的根节点，之后我们可以使用这个Model展示XML结构的数据。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.springmvcdemo.model;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.xml.bind.annotation.XmlRootElement;</span><br><span class="line"></span><br><span class="line"><span class="meta">@XmlRootElement</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">	<span class="keyword">private</span> String age;</span><br><span class="line">	<span class="keyword">private</span> String userName;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> age;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(String age)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.age = age;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getUserName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> userName;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserName</span><span class="params">(String userName)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.userName = userName;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">User</span><span class="params">(<span class="keyword">int</span> id, String age, String userName)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.id = id;</span><br><span class="line">		<span class="keyword">this</span>.age = age;</span><br><span class="line">		<span class="keyword">this</span>.userName = userName;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>3.JSON和XML视图</strong></p>
<p>若要输出 JSON 和 XML 视图，你不需要做任何额外的工作，Spring MVC 将自动处理转换.</p>
<p><strong>4.Freemarker View</strong><br>一个Freemarker View用来展示查询的User数据.<br>File: /WEB-INF/views/user/view.ftl</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span> <span class="comment">&lt;!-- 使用 HTML5 doctype，不区分大小写 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"zh-cmn-Hans"</span>&gt;</span> <span class="comment">&lt;!-- 更加标准的 lang 属性写法 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 声明文档使用的字符编码 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">'utf-8'</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 优先使用 IE 最新版本和 Chrome --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge,chrome=1"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Spring @MVC ContentNegotiatingViewResolver<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">b</span>&gt;</span>User ID :<span class="tag">&lt;/<span class="name">b</span>&gt;</span> $&#123;user.id&#125; <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">b</span>&gt;</span>User Age :<span class="tag">&lt;/<span class="name">b</span>&gt;</span> $&#123;user.age&#125; <span class="tag">&lt;<span class="name">br</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">b</span>&gt;</span>User Name :<span class="tag">&lt;/<span class="name">b</span>&gt;</span> $&#123;user.userName&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong>5.Controller</strong></p>
<p>新建一个UserController,如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.springmvcdemo.controller;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.springmvcdemo.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ui.Model;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/users"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping</span>(value = <span class="string">"/&#123;id&#125;"</span>, method = RequestMethod.GET)</span><br><span class="line">    <span class="meta">@ResponseStatus</span>(HttpStatus.OK)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUser</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> <span class="keyword">int</span> id, Model model) </span>&#123;</span><br><span class="line">        model.addAttribute(userService.findById(id));</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"user/view"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">	@RequestMapping(value = "/&#123;id&#125;", method = RequestMethod.PUT)</span></span><br><span class="line"><span class="comment">    @ResponseStatus(HttpStatus.NO_CONTENT)</span></span><br><span class="line"><span class="comment">    public void putUser(@PathVariable("id") int id, User user) &#123;</span></span><br><span class="line"><span class="comment">        userService.update(user);</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    @RequestMapping(value = "/&#123;id&#125;", method = RequestMethod.DELETE)</span></span><br><span class="line"><span class="comment">    @ResponseStatus(HttpStatus.NO_CONTENT)</span></span><br><span class="line"><span class="comment">    public void deleteUser(@PathVariable("id") int id) &#123;</span></span><br><span class="line"><span class="comment">        userService.deleteById(id);</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    @RequestMapping(method = RequestMethod.POST)</span></span><br><span class="line"><span class="comment">    @ResponseStatus(HttpStatus.CREATED)</span></span><br><span class="line"><span class="comment">    public @ResponseBody User createUser(User user, HttpServletRequest result, HttpServletResponse response) &#123;</span></span><br><span class="line"><span class="comment">        userService.insert(user);</span></span><br><span class="line"><span class="comment">        response.setHeader("Location", "/users/" + user.getId());</span></span><br><span class="line"><span class="comment">        return user;</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>6.ContentNegotiatingViewResolver</strong></p>
<p>在面向人类访问的Web应用程序中，选择的视图通常来讲都会渲染为HTML。视图解决方案是个简单的活动，如果根据视图名匹配上了视图，那这就是我们要用的视图了，当要讲视图名解析为能够产生资源表述的视图时，我们就需要另外一个维度需要考虑了，视图不仅要匹配视图名，而且选择的视图要适合客户端。如果客户端想要JSON，那么渲染HTML的视图就不行了——尽管视图名可能匹配。</p>
<p>Spring的ContentNegotiatingViewResolver是一个特殊的视图解析器，它考虑到了客户端所需要的内容类型。就像其他的视图解析器一样，它要作为一个bean配置在Spring应用上下文里。</p>
<p>在spring-mvc.xml里面增加如下内容：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ContentNegotiatingViewResolver --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.ContentNegotiatingViewResolver"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"contentNegotiationManager"</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.accept.ContentNegotiationManagerFactoryBean"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"defaultContentType"</span> <span class="attr">value</span>=<span class="string">"text/html"</span>/&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mediaTypes"</span>&gt;</span></span><br><span class="line">		   <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">			  <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"json"</span> <span class="attr">value</span>=<span class="string">"application/json"</span>/&gt;</span></span><br><span class="line">			  <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"xml"</span> <span class="attr">value</span>=<span class="string">"application/xml"</span>/&gt;</span></span><br><span class="line">			  <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">"html"</span> <span class="attr">value</span>=<span class="string">"text/html"</span>/&gt;</span></span><br><span class="line">		   <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"defaultViews"</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- JSON View --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">bean</span></span></span><br><span class="line"><span class="tag">				<span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.json.MappingJackson2JsonView"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">&lt;!-- JAXB XML View --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.xml.MarshallingView"</span>&gt;</span></span><br><span class="line">			   <span class="tag">&lt;<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">					  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.oxm.jaxb.Jaxb2Marshaller"</span>&gt;</span></span><br><span class="line">							 <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"classesToBeBound"</span>&gt;</span></span><br><span class="line">									<span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">										   <span class="tag">&lt;<span class="name">value</span>&gt;</span>com.springmvcdemo.model.User<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">									<span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">							 <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">					  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">			   <span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">	 <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><strong>7.Demo</strong></p>
<p>启动服务，</p>
<p><a href="http://localhost:8080/users/2.xml" target="_blank" rel="noopener">http://localhost:8080/users/2.xml</a> 返回xml视图：</p>
<p><img src="/assets/blogImg/springmvc/Springmvc-rest-xml-view
.png" alt="image"></p>
<p><a href="http://localhost:8080/users/2.json" target="_blank" rel="noopener">http://localhost:8080/users/2.json</a> 返回json视图：</p>
<p><img src="/assets/blogImg/springmvc/Springmvc-rest-json-view
.png" alt="image"></p>
<p><a href="http://localhost:8080/users/2" target="_blank" rel="noopener">http://localhost:8080/users/2</a> 返回默认视图(html)：</p>
<p><img src="/assets/blogImg/springmvc/Springmvc-rest-default-view.png" alt="image"></p>
<p>(代码已提交到GitHub：<a href="https://github.com/jasonli822/MySpringMvcFrame" target="_blank" rel="noopener">https://github.com/jasonli822/MySpringMvcFrame</a>)</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/07/01/springmvc-framework-6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Jason Li">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/assets/totoro.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="jasonli822的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/07/01/springmvc-framework-6/" itemprop="url">使用IntelliJ IDEA开发SpringMVC网站（六）利用mybatis-generator自动生成代码</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-07-01T08:58:23+08:00">
                2016-07-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在上一篇<a href="/2016/06/30/springmvc-framework-5/">《使用IntelliJ IDEA开发SpringMVC网站（五）集成事务管理》</a>文章中我们集成了事务管理，本文讲解一下利用mybatis-generator自动生成代码。</p>
<p><strong>MyBatis Generator介绍</strong></p>
<p>MyBatis Generator (MBG) 是一个Mybatis的代码生成器 MyBatis 和 iBATIS. 他可以生成Mybatis各个版本的代码，和iBATIS 2.2.0版本以后的代码。 他可以内省数据库的表（或多个表）然后生成可以用来访问（多个）表的基础对象。 这样和数据库表进行交互时不需要创建对象和配置文件。 MBG的解决了对数据库操作有最大影响的一些简单的CRUD（插入，查询，更新，删除）操作。 您仍然需要对联合查询和存储过程手写SQL和对象。</p>
<p>官方文档：<a href="http://www.mybatis.org/generator/" target="_blank" rel="noopener">http://www.mybatis.org/generator/</a></p>
<p>中文翻译：<a href="http://generator.sturgeon.mopaas.com/" target="_blank" rel="noopener">http://generator.sturgeon.mopaas.com/</a></p>
<p>MyBatis Generator<strong>(以下简称为MBG)</strong>有三种用法：命令行、eclipse插件、Maven插件。Maven插件比较方便，可以在eclipse/intellij idea等ide上通用。</p>
<p>MyBatis Generator  With Maven <a href="http://mybatis.github.io/generator/running/runningWithMaven.html" target="_blank" rel="noopener">http://mybatis.github.io/generator/running/runningWithMaven.html</a></p>
<p><strong>STEP 1.</strong> 在pom文件中,添加MGB插件，IDE会自动帮我们下载插件：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>springmvcdemo<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.generator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-generator-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">configurationFile</span>&gt;</span>src/main/resources/mybatis-generator/generatorConfig.xml<span class="tag">&lt;/<span class="name">configurationFile</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">verbose</span>&gt;</span>true<span class="tag">&lt;/<span class="name">verbose</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">overwrite</span>&gt;</span>true<span class="tag">&lt;/<span class="name">overwrite</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><strong>STEP 2.</strong> 在maven项目下的src/main/resources 目录下建立名为mybatis-generator的目录，在该目录下建立 generatorConfig.xml的配置文件，作为mybatis-generator-maven-plugin 插件的执行目标(默认是加载src/main/resources下面的generatorConfig.xml)，模板如下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE generatorConfiguration</span></span><br><span class="line"><span class="meta">        PUBLIC "-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN"</span></span><br><span class="line"><span class="meta">        "http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd"&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">generatorConfiguration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--数据库驱动jar --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">classPathEntry</span> <span class="attr">location</span>=<span class="string">"E:\mysql-connector-java-5.1.7-bin.jar"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context</span> <span class="attr">id</span>=<span class="string">"MysqlContext"</span> <span class="attr">targetRuntime</span>=<span class="string">"MyBatis3"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--去除注释  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">commentGenerator</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suppressAllComments"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">commentGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--数据库连接 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jdbcConnection</span> <span class="attr">driverClass</span>=<span class="string">"com.mysql.jdbc.Driver"</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">connectionURL</span>=<span class="string">"jdbc:mysql://localhost:3306/mybatis"</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">userId</span>=<span class="string">"root"</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">password</span>=<span class="string">"123456"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">jdbcConnection</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--默认false</span></span><br><span class="line"><span class="comment">           Java type resolver will always use java.math.BigDecimal if the database column is of type DECIMAL or NUMERIC.</span></span><br><span class="line"><span class="comment">         --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaTypeResolver</span> &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"forceBigDecimals"</span> <span class="attr">value</span>=<span class="string">"false"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaTypeResolver</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--生成实体类 指定包名 以及生成的地址 （可以自定义地址，但是路径不存在不会自动创建  使用Maven生成在target目录下，会自动创建） --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaModelGenerator</span> <span class="attr">targetPackage</span>=<span class="string">"com.springmvcdemo.model"</span> <span class="attr">targetProject</span>=<span class="string">"MAVEN"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"enableSubPackages"</span> <span class="attr">value</span>=<span class="string">"false"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"trimStrings"</span> <span class="attr">value</span>=<span class="string">"true"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaModelGenerator</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--生成SQLMAP文件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sqlMapGenerator</span> <span class="attr">targetPackage</span>=<span class="string">"com.springmvcdemo.mapper"</span>  <span class="attr">targetProject</span>=<span class="string">"MAVEN"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"enableSubPackages"</span> <span class="attr">value</span>=<span class="string">"false"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">sqlMapGenerator</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--生成Dao文件 可以配置--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaClientGenerator</span> <span class="attr">type</span>=<span class="string">"XMLMAPPER"</span> <span class="attr">targetPackage</span>=<span class="string">"com.springmvcdemo.mapper"</span>  <span class="attr">targetProject</span>=<span class="string">"MAVEN"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"enableSubPackages"</span> <span class="attr">value</span>=<span class="string">"false"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaClientGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--对应数据库表 mysql可以加入主键自增 字段命名 忽略某字段等--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">"t_user"</span> <span class="attr">domainObjectName</span>=<span class="string">"User"</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">generatorConfiguration</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>这里IDEA报了个错，加载不了dtd文件，</p>
<p><img src="/assets/blogImg/springmvc/URI_is_not_registered.png" alt="image"></p>
<p>从CSDN上 <a href="http://download.csdn.net/detail/zhangyaoyaoai/9267501" target="_blank" rel="noopener">http://download.csdn.net/detail/zhangyaoyaoai/9267501</a> 下载该文件，放在generatorConfig.xml的同一个目录下面。</p>
<p><code>targetRuntime=&quot;MyBatis3&quot;</code><br>因为我们使用的是MyBatis，所以targetRunTime选择的是MyBatis3,如果使用的是IBatis的话，需要这样配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;context id=&quot;MysqlContext&quot; targetRuntime=&quot;Ibatis2Java5&quot;&gt;</span><br><span class="line">&lt;javaClientGenerator type=&quot;SPRING&quot;</span><br></pre></td></tr></table></figure></p>
<p>关于generatorConfig.xml配置文件的详细解释请参考：<a href="http://blog.csdn.net/isea533/article/details/42102297" target="_blank" rel="noopener">http://blog.csdn.net/isea533/article/details/42102297</a></p>
<p><strong>STEP 3. </strong> 测试运行</p>
<p>点击Maven Project——项目——Plugins——mybatis generator——Run Maven build</p>
<p><img src="/assets/blogImg/springmvc/run_mybatis_generator.png" alt="image"></p>
<p>BUILD SUCCESS</p>
<p><img src="/assets/blogImg/springmvc/maven_mybatis_generator_build_success.png" alt="image"></p>
<p><img src="/assets/blogImg/springmvc/generated-sources_folder.png" alt="image"></p>
<p><strong>STEP4. </strong>  根据自己项目的配置，把生成的代码拷贝到自己的项目中去。</p>
<p>至此，利用mybatis-generator自动生成代码功能完成。接下来会继续完善框架。<br>(代码已提交到GitHub：<a href="https://github.com/jasonli822/MySpringMvcFrame" target="_blank" rel="noopener">https://github.com/jasonli822/MySpringMvcFrame</a>)</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/assets/totoro.png"
                alt="Jason Li" />
            
              <p class="site-author-name" itemprop="name">Jason Li</p>
              <p class="site-description motion-element" itemprop="description">看清现实，心怀梦想，幽默面对。</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">25</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">25</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/jasonli822" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:lihu822@163.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jason Li</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  







<!-- LOCAL: You can save these files to your site and update links -->
    
        
        <link rel="stylesheet" href="https://aimingoo.github.io/gitmint/style/default.css">
        <script src="https://aimingoo.github.io/gitmint/dist/gitmint.browser.js"></script>
    
<!-- END LOCAL -->

    

    







  





  

  

  

  
  

  

  

  

</body>
</html>
